<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Stream Browser</title>
<style>
  body{background:black;color:white;font-family:monospace}
  #v{width:100%;height:90vh;background:#000}
</style>
</head>
<body>
<video id="v" autoplay playsinline></video>

<script>
const video = document.getElementById("v");
let pc = new RTCPeerConnection();

let dc = pc.createDataChannel("input");
dc.onopen = ()=>console.log("Input channel ready");

document.addEventListener("keydown",e=>{
  if(dc.readyState === "open"){
    dc.send(JSON.stringify({type:"key",key:e.key}));
  }
});

pc.ontrack = e=>{
  video.srcObject = e.streams[0];
};

// signaling for WebRTC
let ws = new WebSocket(location.protocol==="https:"?"wss://"+location.host:"ws://"+location.host);
ws.onmessage = async e=>{
  const msg = JSON.parse(e.data);
  if(msg.type === "answer"){
    await pc.setRemoteDescription({type:"answer",sdp:msg.sdp});
  }
  if(msg.type === "error"){
    console.error(msg.message);
  }
};

ws.onopen = async()=>{
  const offer = await pc.createOffer({offerToReceiveVideo:true});
  await pc.setLocalDescription(offer);
  ws.send(JSON.stringify({type:"offer",sdp:offer.sdp}));
};
</script>
</body>
</html>
